# 01.服务器状态码含义

+ 100-199 用于指定客户端应相应的某些动作；
+ 200-299 用于表示请求成功；
+ 300-399 用于已经移动的文件并且常被包含在定位头信息中指定新的地址信息；
+ 400-499 用于指出客户端的错误；
  + 401没有权限
  + 402需付款
  + 403禁止访问
  + 404没有找到
+ 500-599 用于支持服务器错误；



# 02. 浏览器缓存

缓存的目的：

**减少了时长从而优化用户体验，也减少了流量消耗，减轻了服务器的压力**。



## 强制缓存

定义：直接从本地副本比对读取，**不去请求服务器**，返回的状态码是 **200**。

- **expires**： （请求头）是 `HTTP1.0` 中定义的缓存字段。当我们请求一个资源，服务器返回时，可以在 `Response Headers` 中增加 `expires` 字段表示资源的过期时间。（缺点：本地时间不准确）

```js
expires: Thu, 03 Jan 2019 11:43:04 GMT
```

- **cache-control：**（请求头）设置一个时间长度，单位为s，不依赖客户端；解决了expires的问题；

```http
cache-control: public, max-age=3600, s-maxage=3600 
// max-age优先级大于s-maxage；
// 可以通过设置 max-age 为 0 表示立马过期来向服务器请求资源;
```

## 协商缓存

定义：**会去服务器比对**，若没改变才直接读取本地缓存，返回的状态码是 **304**。

设置了 `no-cache` 和 `no-store` 则本地缓存会被忽略，会去**请求服务器验证**资源是否更新，如果没更新才继续使用本地缓存，此时返回的是 304，这就是协商缓存。协商缓存主要包括 `last-modified` 和 `etag`。

- **last-modified：**记录资源最后修改的时间。(响应头)

```http
last-modified: Thu, 20 Dec 2018 11:36:00 GMT
```

当我们再次请求的时候，请求头就会带上`if-modified-since` 字段，值是之前返回的`last-modified`。服务器会对比字段，如果一致，告诉浏览器直接使用缓存返回304；如果不一致，返回最新后台资源，并修改`last-modified`的值。

但 `last-modified` 有以下**两个缺点**：

（1）只要编辑了，不管内容有没有修改，都会修改时间，当成新资源返回，从而导致了没必要的请求；

（2）时间上只能精确到秒，在一秒内的修改是检测不到更新的；


- **etag：**基于资源的内容编码生成一串唯一的标识字符串，只要内容不同，就会生成不同的 `etag`。启用 `etag` 之后，请求资源后的响应返回会增加一个 `etag` 字段（**响应头**）

```http
etag: "FllOiaIvA1f-ftHGziLgMIMVkVw_"
```

当再次请求该资源时，请求头会带有 `if-none-match` 字段，值是之前返回的 `etag` 值，如：`if-none-match:"FllOiaIvA1f-ftHGziLgMIMVkVw_"`。服务端会根据该资源当前的内容生成对应的标识字符串和该字段进行对比，若一致则代表未改变可直接使用本地缓存并返回 304；若不一致则返回新的资源（状态码200）并修改返回的 `etag` 字段为新的值。

**缺点**：就是每次生成标识字符串会增加服务器的开销，因为每次都要检测内容是否变化；

优先级：etag > last-modified



## 浏览器刷新分析

##### 1、标签进入、输入url回车进入

这种情况下会根据实际设计的缓存策略去判断。

1. 由于该例没有设置 `no-cache` 和 `no-store`，所以默认先走强缓存路线。根据 `cache-control` （`expires` 优先级低）判断缓存是否过期，若没有过期则此时返回 `200(from cache)`。
2. 若本地缓存已经过期再走协商缓存路线，根据之前的 `last-modified` 值去与服务器比对，若这个时间之后没有改过则去读取本地缓存，返回 `304(not modified)`。
3. 否则返回新的资源，状态码 `200(ok)`，并更新返回响应的 `last-modified` 值。

##### 2、按刷新按钮、F5 刷新、网页右键“重新加载”

这种情况下，实际是浏览器将 `cache-control` 的 `max-age` 直接设置成了 0，让缓存立即过期，直接走协商缓存路线。发送的请求头如下：

```http
cache-control: max-age=0
if-modified-since: Tue, 20 Nov 2018 00:41:14 GMT
```

##### 3、ctrl + F5 强制刷新

强制刷新的情况下，浏览器会强行设置 `no-cache`，强制获取最新的资源，就连 `if-modified-since` 等其他缓存协议字段都会被吃掉。此时发送的请求头如下：

```http
cache-control: no-cache
pragma: no-cache
```



